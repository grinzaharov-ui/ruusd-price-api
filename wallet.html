<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RuUSD Official Wallet</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.15.0/ethers.umd.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 0 auto; 
            padding: 20px; 
            background-color: #f5f5f5; 
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        h1 { color: #2c3e50; }
        .balance { 
            font-size: 24px; 
            font-weight: bold; 
            color: #27ae60; 
            margin: 20px 0; 
        }
        .price { 
            font-size: 18px; 
            color: #2980b9; 
            margin-bottom: 20px; 
        }
        button { 
            background: #3498db; 
            color: white; 
            border: none; 
            padding: 10px 20px; 
            border-radius: 5px; 
            cursor: pointer; 
            margin: 5px; 
        }
        button:hover { background: #2980b9; }
        .section { margin: 30px 0; }
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üí∞ RuUSD Official Wallet</h1>
        
        <div class="price" id="price">Official Price: $1.00</div>
        
        <div class="button-group">
            <button onclick="connectWallet()">–ü–æ–¥–∫–ª—é—á–∏—Ç—å MetaMask</button>
            <button onclick="setupCustomRPC()">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å RPC –≤ MetaMask</button>
            <button onclick="addRuUSDToken()">–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω RUUSD</button>
        </div>
        
        <div class="balance" id="balance">Balance: -</div>
        
        <div class="section">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–æ–∫–µ–Ω–µ:</h3>
            <p><strong>–ö–æ–Ω—Ç—Ä–∞–∫—Ç:</strong> 0x0B4CCd0b877Df039e295Fd52533c14EF151D223d</p>
            <p><strong>–°–µ—Ç—å:</strong> Polygon Mainnet</p>
            <p><strong>–¶–µ–Ω–∞:</strong> –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è $1.00</p>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONTRACT_ADDRESS = '0x0B4CCd0b877Df039e295Fd52533c14EF151D223d';
        const RPC_URL = 'https://ruusd-price-api.onrender.com/api/rpc-price';
        
        // ABI –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π ERC-20
        const ERC20_ABI = [
            'function balanceOf(address) view returns (uint256)',
            'function transfer(address to, uint256 amount) returns (bool)',
            'function decimals() view returns (uint8)',
            'function symbol() view returns (string)'
        ];

        let provider;
        let signer;
        let contract;

        // –í—Å–µ–≥–¥–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—É—é —Ü–µ–Ω—É $1
        function updatePriceDisplay() {
            document.getElementById('price').innerText = 'Official Price: $1.00 (Fixed)';
        }

        // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞
        async function connectWallet() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const accounts = await window.ethereum.request({ 
                        method: 'eth_requestAccounts' 
                    });
                    
                    provider = new ethers.BrowserProvider(window.ethereum);
                    signer = await provider.getSigner();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, ERC20_ABI, signer);
                    
                    await updateBalance();
                    setInterval(updateBalance, 30000); // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫
                    
                } catch (error) {
                    console.error('Error connecting wallet:', error);
                    alert('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–æ—à–µ–ª—å–∫–∞: ' + error.message);
                }
            } else {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ MetaMask!');
            }
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
        async function updateBalance() {
            if (!contract) return;
            
            try {
                const accounts = await window.ethereum.request({ 
                    method: 'eth_accounts' 
                });
                
                if (accounts.length === 0) return;
                
                const balance = await contract.balanceOf(accounts[0]);
                const decimals = await contract.decimals();
                const balanceFormatted = ethers.formatUnits(balance, decimals);
                
                document.getElementById('balance').innerText = 
                    `Balance: ${balanceFormatted} RUUSD ($${balanceFormatted})`;
                    
            } catch (error) {
                console.error('Error updating balance:', error);
            }
        }

        // –ù–ê–°–¢–†–û–ô–ö–ê RPC –î–õ–Ø POLYGON (–ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø)
        async function setupCustomRPC() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    await window.ethereum.request({
                        method: 'wallet_addEthereumChain',
                        params: [{
                            chainId: '0x89',
                            chainName: 'Polygon Mainnet',
                            nativeCurrency: {
                                name: 'POL',
                                symbol: 'POL', // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–∏–º–≤–æ–ª –¥–ª—è Polygon
                                decimals: 18
                            },
                            rpcUrls: [RPC_URL],
                            blockExplorerUrls: ['https://polygonscan.com/']
                        }]
                    });
                    alert('RPC —É—Å–ø–µ—à–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ MetaMask!');
                } catch (error) {
                    console.error('Error setting up RPC:', error);
                    alert('–û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ RPC: ' + error.message);
                }
            }
        }

        // –î–û–ë–ê–í–õ–ï–ù–ò–ï –¢–û–ö–ï–ù–ê RUUSD –í METAMASK (–ù–û–í–ê–Ø –§–£–ù–ö–¶–ò–Ø)
        async function addRuUSDToken() {
            if (typeof window.ethereum !== 'undefined') {
                try {
                    const wasAdded = await window.ethereum.request({
                        method: 'wallet_watchAsset',
                        params: {
                            type: 'ERC20',
                            options: {
                                address: CONTRACT_ADDRESS,
                                symbol: 'RUUSD',
                                decimals: 18,
                                image: 'https://ruusd-price-api.onrender.com/logo.png' // –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–∑–∂–µ
                            }
                        }
                    });
                    
                    if (wasAdded) {
                        alert('–¢–æ–∫–µ–Ω RUUSD —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω –≤ MetaMask!');
                    } else {
                        alert('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–º–µ–Ω–∏–ª –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞.');
                    }
                } catch (error) {
                    console.error('Error adding token:', error);
                    alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: ' + error.message);
                }
            } else {
                alert('MetaMask –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω!');
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        updatePriceDisplay();
    </script>
</body>
</html>